doctype html
html(lang="en")
  head
    meta(charset="utf-8")
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous")
    title Climate financing opportunity costs
    link(rel="stylesheet", type="text/css", href="public/style.css")
  body.text-responsive
    include includes/header.pug
    include includes/mixins.pug

    div.d-flex.flex-column.justify-content-center
      div(class="d-flex flex-wrap justify-content-center py-3 mb-4", style="margin:0 auto; width: 60%;")
        |We present the result for the present value of compensation workers
        |for lost wages and retraining costs.

        // Output
        table.table
          tr
            td Global PV compensation workers for lost wages (in trillion dollars)
            td
              output#pv-lost-wage N/A
          tr
            td Global PV retraining cost (in trillion dollars)
            td
              output#pv-retraining-cost N/A

      // Input
      div(class="d-flex flex-wrap justify-content-center py-3 mb-4", style="margin:0 auto")
        +discountRate

    // Data
    .px-3.mb-3
      +resultDataDownload

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous")
    script(type="module").
      // This is the data
      import {sensitivityAnalysisResult} from "./js/coal_worker_sensitivity_analysis.js"

      function calculate() {
        const _get = (id) => document.getElementById(id).value
        const discountRate = _get("discount-rate")

        const data = sensitivityAnalysisResult[discountRate]

        // Update output
        const sumValues = obj => Object.values(obj).reduce((a, b) => a + b, 0)
        const lostWageObj = data["compensation workers for lost wages"]
        document.getElementById("pv-lost-wage").innerHTML = sumValues(lostWageObj).toFixed(3)
        const retrainCostObj = data["retraining costs"]
        document.getElementById("pv-retraining-cost").innerHTML = sumValues(retrainCostObj).toFixed(3)

        // Show raw data that can be copied/downloaded
        const jsonData = JSON.stringify(data)
        document.getElementById("result-data").innerHTML = jsonData
        const downloadElement = document.getElementById("download-result-data")
        downloadElement.href = "data:x-application/xml;charset=utf-8," + escape(jsonData)
        downloadElement.download = `climate_financing_coal_worker_${discountRate}.json`
      }
      window.calculate = calculate

      calculate()

